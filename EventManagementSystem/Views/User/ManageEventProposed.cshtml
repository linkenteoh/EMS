@model EventEditVM
@{
    ViewBag.Title = "ManageEventProposed";
}

@section head{
    <style>
        .tooltip1 {
            position: relative;
            display: inline-block;
        }

            .tooltip1 .tooltiptext {
                width: 120px;
                top: 50%;
                left: 50%;
                margin-left: -60px;
                visibility: hidden;
                width: 120px;
                background-color: #c3c3c3;
                color: #fff;
                text-align: center;
                border-radius: 6px;
                padding: 5px 0;
                /* Position the tooltip */
                position: absolute;
                z-index: 1;
            }

            .tooltip1:hover .tooltiptext {
                visibility: visible;
            }
    </style>
    }

<div>
    <h2>Manage Event Proposed</h2>
    <hr />

    <div class="col-md-3" style="padding-left:0px">
        <ul class="nav nav-pills flex-column">
            <li class="active"><a data-toggle="pill" href="#detail">Detail</a></li>
            @if (Model.approvalStat == null)
            {
                <li><a data-toggle="pill" href="#editdetail">Edit Detail</a></li>

            }
            else
            {
                <li class="tooltip1"><a style="cursor:not-allowed" href="#" disabled>Edit Detail</a><span class="tooltiptext">Accepted event can't be edited</span></li>
            }
            @{ 
                int participants = Model.participants - Model.availability;
            }

            <li><a data-toggle="pill" href="#registration">Registration (@participants/@Model.participants)</a></li>
            <li><a data-toggle="pill" href="#payment">Payment</a></li>
        </ul>
    </div>

    <div class="col-md-9 tab-content">
        <div id="detail" class="tab-pane fade in active">
            <div class="outerDiv">
                <div class="head" style="display:inline-block">
                    <div>
                        <h3 style="margin:0;padding-bottom:10px; display:inline-block">@Model.name</h3> (@if (Model.approvalStat == null) { <span class="text-warning">Pending</span> } else if (Model.approvalStat == true) { <span class="text-success">Accepted</span> } else if (Model.approvalStat == false) { <span class="text-danger">Denied</span> })
                    </div>
                </div>
                <div class="images" style="overflow-x:hidden">
                    <div class="row">
                        <div class="col-md-8" style="border: padding:0px; margin:0px;">
                            <img src="~/Photo/@Model.photoURL" style="width:500px; height:500px" />
                        </div>
                        <div class="col-md-4">
                            <div class="row">
                                <p style="width:250px;height:250px">Another image</p>
                            </div>
                            <div class="row">
                                <p style="width:250px;height:250px">Another image</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <table class="table">
                        <tr>
                            <th>Name</th>
                            <td>: @Model.name</td>
                        </tr>
                        <tr>
                            <th>Description</th>
                            <td>: @Model.des</td>
                        </tr>
                        <tr>
                            <th>Start date</th>
                            <td>: @Model.startDate.ToString("dd-MM-yyy")</td>
                        </tr>
                        <tr>
                            <th>End date</th>
                            <td>: @Model.endDate.ToString("dd-MM-yyy")</td>
                        </tr>
                        <tr>
                            <th>Start time</th>
                            <td>: @Model.startTime</td>
                        </tr>
                        <tr>
                            <th>End time</th>
                            <td>: @Model.endTime</td>
                        </tr>
                        <tr>
                            <th>Registration fees (RM)</th>
                            <td>: @Model.price</td>
                        </tr>

                    </table>
                </div>
            </div>
        </div>
        <div id="editdetail" class="tab-pane fade in">
            <h3>Edit event details</h3>
            <hr />
            <form class="form" method="post" enctype="multipart/form-data">
                @Html.ValidationSummary(true)
                <div class="container rounded bg-white mt-5 mb-5">
                    <div class="row">
                        <div class="col-md-3 border-right">
                            <div class="d-flex flex-column align-items-center text-center p-3 py-5">
                                <label class="upload">
                                    <img class="img-thumbnail" src="~/Photo/@Model.photoURL">
                                    @Html.TextBoxFor(e => e.photoURL, new
                                    {
                                   type = "file",
                                        accept = "image/jpeg, image/png",
                                   hidden = ""
                                    })

                                </label>
                            </div>
                        </div>

                        <div class="col-md-5 border-right">
                            <div class="p-3 py-5">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="text-right">Edit Event</h4>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-6">
                                        @Html.LabelFor(e => e.name, "Name")@Html.TextBoxFor(e => e.name, new { maxlength = 20, autofocus = "", @class = "form-control", placeholder = "Name" })
                                        @Html.ValidationMessageFor(e => e.name)
                                    </div>
                                    <div class="col-md-6">
                                        @Html.LabelFor(e => e.price, "Price")@Html.TextBoxFor(e => e.price, new { type = "number", @class = "form-control", placeholder = "price", min = "0" })
                                        @Html.ValidationMessageFor(e => e.price)
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-12" style="margin-right:0">
                                        @Html.LabelFor(e => e.des, "Description")@Html.TextAreaFor(e => e.des, new
{
style = "width: 100%; height: 200px; resize: none",
@class = "form-control",
autofocus = "",
placeholder = "Description"
})
                                        @Html.ValidationMessageFor(e => e.des)
                                    </div>
                                </div>
                                <div class="row mt-4">
                                    <div class="col-md-6" @Html.LabelFor(e => e.participants, "Participants")>
                                        @Html.TextBoxFor(e => e.participants, new { type = "number", @class = "form-control", placeholder = "participants", min = "0" })
                                        @Html.ValidationMessageFor(e => e.participants)
                                    </div>
                                    <div class="col-md-6">
                                        @Html.LabelFor(e => e.startDate, "Start Date")@Html.TextBoxFor(e => e.startDate, "{0:yyyy-MM-dd}", new { type = "date", @class = "form-control" })
                                        @Html.ValidationMessageFor(e => e.startDate)
                                        @*<small>(@min to @max )</small>*@
                                    </div>
                                    <div class="col-md-6">
                                        @Html.LabelFor(e => e.endDate, "End Date")@Html.TextBoxFor(e => e.endDate, "{0:yyyy-MM-dd}", new { type = "date", @class = "form-control" })
                                        @Html.ValidationMessageFor(e => e.endDate)
                                    </div>
                                    <div class="col-md-6">
                                        @Html.LabelFor(e => e.startTime, "Start Time")@Html.TextBoxFor(e => e.startTime, new { type = "time", @class = "form-control" })
                                        @Html.ValidationMessageFor(e => e.startTime)
                                    </div>
                                    <div class="col-md-6">
                                        @Html.LabelFor(e => e.endTime, "End Time")@Html.TextBoxFor(e => e.endTime, new { type = "time", @class = "form-control" })
                                        @Html.ValidationMessageFor(e => e.endTime)
                                    </div>
                                </div>
                                <div class="mt-5 text-center"><section><button class="btn btn-primary profile-button">Edit Event</button></section></div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

        </div>

        <div id="registration" class="tab-pane fade in">
            <h3>Participants (@ViewBag.ParticipantsCount)</h3>
            @{
                if (ViewBag.ParticipantsCount == 0)
                {
                    <p>No participant(s) yet.</p>
                }
            }
            @foreach (var item in ViewBag.Registrations)
            {
                if (item.Payment.status == true)
                {
                    <div>
                        <img src="~/Photo/@item.User.photo" />
                    </div>
                    <p>@item.User.username</p>
                }
            }

            <h3 style="color:#c5c5c5">Pending (@ViewBag.PendingCount)</h3>
            @{
                if (ViewBag.PendingCount == 0)
                {
                    <p>No pending participant(s) yet.</p>
                }
            }
            @foreach (var item in ViewBag.Registrations)
            {
                if (item.Payment.status == false)
                {
                    <div class="col-md-2">
                        <img src="~/Photo/@item.User.photo" style="width:100px;height:100px;object-fit:cover;border-radius:50%; border:1px solid grey" />
                        <div>
                            <p class="text-center" style="font-weight:bold">@item.User.username</p>
                        </div>
                    </div>
                }
            }
        </div>
        <div id="payment" class="tab-pane fade in">
            <h3>Transactions</h3>
            @if (ViewBag.PaymentsCount == 0)
            {
                <p>No active transaction(s) yet.</p>
            }
            else
            {
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Role</th>
                        <th scope="col">Registration fees(RM)</th>
                        <th scope="col">Paid at</th>
                        <th scope="col">Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in ViewBag.Payments)
                    {
                    <tr>
                        <td>@item.Registration.User.name</td>
                        <td>@item.Registration.User.role</td>
                        <td>@item.Registration.Event.price</td>
                        <td>@item.paymentdate</td>
                        @{
                            if (item.status == true)
                            {
                                <td>Paid</td>
                            }
                            else
                            {
                                <td>Unpaid</td>
                            }
                        }
                    </tr>
                    }
                </tbody>
            </table>
            }

        </div>
    </div>
</div>

